<script>

const canvas = document.getElementById("scratch");
const ctx = canvas.getContext("2d");

canvas.width = 900;
canvas.height = 500;

// couche grise
ctx.fillStyle = "#999";
ctx.fillRect(0,0,canvas.width,canvas.height);

ctx.fillStyle = "white";
ctx.font = "20px Arial";
ctx.fillText("GRATTE ICI",100,110);

let scratching = false;
let revealed = false;

canvas.addEventListener("mousedown", ()=> scratching = true);
canvas.addEventListener("mouseup", ()=> scratching = false);

canvas.addEventListener("mousemove", e=>{
 if(!scratching) return;

 ctx.globalCompositeOperation = "destination-out";

 ctx.beginPath();
 ctx.arc(e.offsetX, e.offsetY, 20, 0, Math.PI*2);
 ctx.fill();

 checkScratch();
});

function checkScratch(){

 if(revealed) return;

 const pixels = ctx.getImageData(0,0,canvas.width,canvas.height);
 let count = 0;

 for(let i=0; i<pixels.data.length; i+=4){
   if(pixels.data[i+3] === 0){
     count++;
   }
 }

 let percent = count / (canvas.width * canvas.height);

 if(percent > 0.85){
   revealed = true;
   document.getElementById("question1").style.display="block";
 }
}


// ------- QUIZ ---------

function checkQ1(correct){
 if(correct){
   document.getElementById("question1").style.display="none";
   document.getElementById("question2").style.display="block";
 } else {
   alert("Mauvaise rÃ©ponse ðŸ˜„");
 }
}

function checkQ2(correct){
 if(correct){
   document.getElementById("question2").style.display="none";
   document.getElementById("revealBtn").style.display="block";
 } else {
   alert("Presque !");
 }
}

function showGift(){
 document.getElementById("result").style.display="block";
}

</script>



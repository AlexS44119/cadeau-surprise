<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>D√©couvre ton cadeau üéÅ</title>

<style>
body {
  font-family: Arial;
  text-align: center;
  background: #f5f5f5;
  overflow-x: hidden;
}

#scratch-container {
  position: relative;
  width: 500px;
  height: 300px;
  margin: 30px auto;
}

canvas {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 15px;
  cursor: pointer;
}

#question1, #question2, #revealBtn, #result {
  display: none;
  margin-top: 20px;
  opacity: 0;
  transition: opacity 0.5s ease;
}

button {
  padding: 10px 15px;
  margin: 8px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: #4CAF50;
  color: white;
  font-size: 16px;
}

button:hover {
  background: #45a049;
}

img {
  max-width: 300px;
  border-radius: 12px;
  margin-top: 20px;
}

.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  background: red;
  top: 0;
  z-index: 9999;
  pointer-events: none;
}
</style>
</head>

<body>

<h2>Gratte pour d√©couvrir ton cadeau üéÅ</h2>

<div id="scratch-container">
  <canvas id="scratch"></canvas>
</div>

<div id="question1">
  <h3>Question 1 :</h3>
  <p>Quelle est notre activit√© pr√©f√©r√©e ensemble ?</p>
  <button onclick="checkQ1(false)">Cin√©ma</button>
  <button onclick="checkQ1(true)">Voyager</button>
  <button onclick="checkQ1(false)">Sport</button>
</div>

<div id="question2">
  <h3>Question 2 :</h3>
  <p>Dans quel pays aimerais-tu aller ?</p>
  <button onclick="checkQ2(true)">Italie</button>
  <button onclick="checkQ2(false)">Canada</button>
  <button onclick="checkQ2(false)">Japon</button>
</div>

<div id="revealBtn">
  <button onclick="showGift()">üéÅ R√©v√©ler le cadeau</button>
</div>

<div id="result">
  <h2>Surprise !</h2>
  <img src="cadeau.jpg">
</div>

<script>
// ------- SCRATCH ---------
const canvas = document.getElementById("scratch");
const ctx = canvas.getContext("2d");
canvas.width = 500;
canvas.height = 300;

// Couche grise
ctx.fillStyle = "#999";
ctx.fillRect(0,0,canvas.width,canvas.height);

// Texte
ctx.fillStyle = "white";
ctx.font = "30px Arial";
ctx.fillText("GRATTE ICI", 150, 160);

let scratching = false;
let revealed = false;

// Confetti
function createConfetti(){
  for(let i=0;i<100;i++){
    const c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = Math.random()*window.innerWidth+'px';
    c.style.background = `hsl(${Math.random()*360}, 100%, 50%)`;
    document.body.appendChild(c);
    animateConfetti(c);
  }
}
function animateConfetti(el){
  let top = 0;
  const fall = setInterval(()=>{
    top += Math.random()*5+2;
    el.style.top = top+'px';
    if(top>window.innerHeight){ el.remove(); clearInterval(fall);}
  }, 20);
}

// --- Desktop ---
canvas.addEventListener("mousedown", ()=> scratching = true);
canvas.addEventListener("mouseup", ()=> scratching = false);
canvas.addEventListener("mousemove", e=>{
  if(!scratching) return;
  scratch(e.offsetX, e.offsetY);
});

// --- Mobile ---
canvas.addEventListener("touchstart", e=>{
  scratching = true;
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  scratch(touch.clientX - rect.left, touch.clientY - rect.top);
  e.preventDefault();
});
canvas.addEventListener("touchmove", e=>{
  if(!scratching) return;
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  scratch(touch.clientX - rect.left, touch.clientY - rect.top);
  e.preventDefault();
});
canvas.addEventListener("touchend", e=>{ scratching = false; });

// Grattage
function scratch(x,y){
  // effet poudre
  for(let i=0;i<5;i++){
    const rx = x + (Math.random()*20-10);
    const ry = y + (Math.random()*20-10);
    ctx.globalCompositeOperation = "destination-out";
    ctx.beginPath();
    ctx.arc(rx, ry, Math.random()*10+5, 0, Math.PI*2);
    ctx.fill();
  }
  checkScratch();
}

// V√©rification 85%
function checkScratch(){
  if(revealed) return;
  const pixels = ctx.getImageData(0,0,canvas.width,canvas.height);
  let count = 0;
  for(let i=0;i<pixels.data.length;i+=4){
    if(pixels.data[i+3]===0) count++;
  }
  let percent = count / (canvas.width*canvas.height);
  if(percent>0.85){
    revealed = true;
    fadeIn(document.getElementById("question1"));
  }
}

// Animation fadeIn
function fadeIn(el){
  el.style.display="block";
  setTimeout(()=> el.style.opacity=1,10);
}

// ------- QUIZ ---------
function checkQ1(correct){
  if(correct){
    fadeOut(document.getElementById("question1"),()=>fadeIn(document.getElementById("question2")));
  } else { alert("Mauvaise r√©ponse üòÑ"); }
}

function checkQ2(correct){
  if(correct){
    fadeOut(document.getElementById("question2"),()=>fadeIn(document.getElementById("revealBtn")));
  } else { alert("Presque !"); }
}

// Fade out helper
function fadeOut(el, callback){
  el.style.opacity=0;
  setTimeout(()=>{ el.style.display="none"; if(callback) callback(); },500);
}

function showGift(){
  fadeOut(document.getElementById("revealBtn"),()=>{ fadeIn(document.getElementById("result")); createConfetti(); });
}
</script>

</body>
</html>

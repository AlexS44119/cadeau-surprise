<!DOCTYPE html>
<html lang="fr">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Ticket Cadeau üéÅ</title>

<style>

/* ----- FOND ----- */
body{
 margin:0;
 font-family:Arial;
 background:linear-gradient(135deg,#667eea,#764ba2);
}

/* ----- CARTE ----- */
.ticket{
 width:100%;
 max-width:600px;
 min-height:100vh;
 margin:auto;
 background:white;
 padding:25px;
 box-sizing:border-box;
 text-align:center;
}

/* ----- SCRATCH ----- */
#scratch-container{
 width:100%;
 aspect-ratio:4/3;
 margin-top:20px;
}

canvas{
 width:100%;
 height:100%;
 border-radius:15px;
 touch-action:none;
}

/* ----- TEXTES ----- */
h2{
 font-size:28px;
 margin-top:0;
}

h3{
 font-size:24px;
}

p{
 font-size:20px;
}

/* ----- QUESTIONS ----- */
#question1,#question2,#revealBtn,#result{
 display:none;
 opacity:0;
 transition:0.5s;
}

/* ----- BOUTONS ----- */
button{
 width:90%;
 font-size:22px;
 padding:18px;
 margin:10px auto;
 border:none;
 border-radius:14px;
 background:linear-gradient(135deg,#667eea,#764ba2);
 color:white;
 display:block;
}

/* ----- IMAGE CADEAU ----- */
img{
 width:100%;
 border-radius:15px;
 margin-top:15px;
}

/* ----- CONFETTIS ----- */
.confetti{
 position:fixed;
 width:10px;
 height:10px;
 top:0;
 pointer-events:none;
}

</style>
</head>

<body>

<div class="ticket">

<h2 id="title">üéÅ Gratte pour d√©couvrir ton cadeau üéÅ</h2>

<div id="scratch-container">
<canvas id="scratch"></canvas>
</div>

<div id="question1">
<h3>Question 1</h3>
<p>Pour qui chanterais-tu : [...] Le Rouge et Noir, l‚ÄôEurope les jalouses
C‚Äôest la couleur de l‚Äôunique vainqueur [...] ?</p>

<button onclick="checkQ1(false)">Perpignan</button>
<button onclick="checkQ1(true)">Stade Toulousain</button>
<button onclick="checkQ1(false)">Saint-Marin</button>
</div>

<div id="question2">
<h3>Question 2</h3>
<p>Si tu devais te faire monter en l'air, qu'elle serais le choix le moins douloureux ?</p>

<button onclick="checkQ2(true)">Air Force One</button>
<button onclick="checkQ2(false)">Vincent Mc Doom</button>
<button onclick="checkQ2(false)">Benoit Saint Denis</button>
</div>

<div id="revealBtn">
<button onclick="showGift()">üéÅ R√©v√©ler le cadeau</button>
</div>

<div id="result">
<h2>‚ú® Surprise ! ‚ú®</h2>
<img src="cadeau.jpg">
</div>

</div>

<script>

/* SCRATCH */
const canvas=document.getElementById("scratch");
const ctx=canvas.getContext("2d");

let scratching=false;
let revealed=false;

/* responsive */
function resizeCanvas(){
 canvas.width=canvas.clientWidth;
 canvas.height=canvas.clientHeight;
 drawOverlay();
}
window.addEventListener("resize",resizeCanvas);
resizeCanvas();

/* overlay */
function drawOverlay(){
 ctx.globalCompositeOperation="source-over";
 ctx.fillStyle="#999";
 ctx.fillRect(0,0,canvas.width,canvas.height);

 ctx.fillStyle="white";
 ctx.font=(canvas.width/10)+"px Arial";
 ctx.fillText("GRATTE ICI",canvas.width/4,canvas.height/2);
}

/* position doigt */
function getTouchPos(e){
 const rect=canvas.getBoundingClientRect();
 return{
  x:e.touches[0].clientX-rect.left,
  y:e.touches[0].clientY-rect.top
 };
}

/* MOBILE FIX SCROLL */
canvas.addEventListener("touchstart",e=>{
 scratching=true;
 e.preventDefault();
},{passive:false});

canvas.addEventListener("touchmove",e=>{
 if(!scratching) return;

 const pos=getTouchPos(e);
 scratch(pos.x,pos.y);

 e.preventDefault();
},{passive:false});

canvas.addEventListener("touchend",()=>{
 scratching=false;
});

/* DESKTOP */
canvas.addEventListener("mousedown",()=>scratching=true);
canvas.addEventListener("mouseup",()=>scratching=false);
canvas.addEventListener("mousemove",e=>{
 if(!scratching) return;
 scratch(e.offsetX,e.offsetY);
});

/* effet poudre */
function scratch(x,y){
 for(let i=0;i<6;i++){
  ctx.globalCompositeOperation="destination-out";
  ctx.beginPath();
  ctx.arc(
    x+(Math.random()*20-10),
    y+(Math.random()*20-10),
    Math.random()*12+6,
    0,Math.PI*2
  );
  ctx.fill();
 }
 checkScratch();
}

/* v√©rification 85% */
function checkScratch(){
 if(revealed) return;

 const pixels=ctx.getImageData(0,0,canvas.width,canvas.height);
 let count=0;

 for(let i=0;i<pixels.data.length;i+=4){
  if(pixels.data[i+3]==0) count++;
 }

 let percent=count/(canvas.width*canvas.height);

 if(percent>0.85){
  revealed=true;

  document.getElementById("scratch-container").remove();
  document.getElementById("title").remove();

  fadeIn(question1);
 }
}

/* transitions */
function fadeIn(el){
 el.style.display="block";
 setTimeout(()=>el.style.opacity=1,10);
}

function fadeOut(el,cb){
 el.style.opacity=0;
 setTimeout(()=>{
  el.style.display="none";
  if(cb) cb();
 },500);
}

/* quiz */
function checkQ1(ok){
 if(ok){
  fadeOut(question1,()=>fadeIn(question2));
 }else alert("Presque !");
}

function checkQ2(ok){
 if(ok){
  fadeOut(question2,()=>fadeIn(revealBtn));
 }else alert("Pas loin !");
}

/* cadeau */
function showGift(){
 fadeOut(revealBtn,()=>{
  fadeIn(result);
  createConfetti();
 });
}

/* confettis */
function createConfetti(){
 for(let i=0;i<120;i++){
  const c=document.createElement("div");
  c.className="confetti";
  c.style.left=Math.random()*window.innerWidth+"px";
  c.style.background=`hsl(${Math.random()*360},100%,50%)`;
  document.body.appendChild(c);
  animateConfetti(c);
 }
}

function animateConfetti(el){
 let top=0;
 const fall=setInterval(()=>{
  top+=Math.random()*5+2;
  el.style.top=top+"px";

  if(top>window.innerHeight){
   el.remove();
   clearInterval(fall);
  }
 },20);
}

</script>

</body>
</html>
